<?php

require_once 't/zeek_extends.php';

class TestZeek extends PHPUnit_Framework_TestCase
{
    private $zeek;
    protected $test_dbname = 'zeek_test';

    public function setUp()
    {
        $zeek = new ExtendsZeek();
        $zeek->start('t/test.ini');
        $zeek->connect_to_database();

        $this->zeek = $zeek;
    }

    public function test_project()
    {
        $zeek = $this->zeek;

    	// we connect with bad login & password
        $this->assertFalse(
            $zeek->connect('no_test', 'no_test', 'no_test'));
        $zeek->checkOutput(
            '{"error":"unexpected project name, login & password!"}');

    	// we connect with good login & password
        $this->assertTrue(
            $zeek->connect('test', 'test', 'test'));
        $this->assertTrue(
            $zeek->checkOutput(
                '{"success":"Connection accepted, now create new project!","action":"project_create"}'));

    	// we create a project
        $this->assertTrue($zeek->project_create('test'));
        $this->assertTrue(
            $zeek->checkOutput('{"redirect":"home.php"}'));
    }
}
